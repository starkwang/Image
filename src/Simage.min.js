(function(){var r={gaussianBlur:[[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,26,4],[1,4,6,4,1]],edge:[[2,-1,2],[-1,-4,-1],[2,-1,2]],detail:[[0,-1,0],[-1,10,-1],[0,-1,0]],sharpen:[[-1,-1,-1],[-1,10,-1],[-1,-1,-1]]};function a(r,a){var n=new Array(r);for(var t=0;t<r;t++){n[t]=new Array(a)}return n}function n(r,a,n,t){this.R=r;this.G=a;this.B=n;this.A=t}function t(r,t){var e=a(t,r.length/4/t);for(var v=0,o=r.length;v<o;v+=4){var f=Math.floor(v/(4*t));var i=v/4%t;e[i][f]=new n(r[v],r[v+1],r[v+2],r[v+3])}return e}function e(r){var a=r.length;var n=r[0].length;var t=new Uint8ClampedArray(a*n*4);var e=0;for(var v=0;v<n;v++){for(var o=0;o<a;o++){t[e]=r[o][v].R;t[e+1]=r[o][v].G;t[e+2]=r[o][v].B;if(r[o][v].A==undefined){t[e+3]=255}else{t[e+3]=r[o][v].A}e=e+4}}return t}function v(r,t){if(t.length%2==0){alert("核矩阵不正确！");return}var e=a(r.length,r[0].length);var v=(t.length-1)/2;var o=t.length;var f=Math.round;for(var i=0,u=r.length;i<u;i++){for(var h=0,l=r[i].length;h<l;h++){var g,c,d;var s=0;var w=0;var B=0;var A=0;for(var y=i-v,G=i+v,M=0;y<=G;y++){for(var R=h-v,m=h+v,b=0;R<=m;R++){if(y<0||R<0){continue}if(y>=r.length||R>=r[0].length){continue}s+=r[y][R].R*t[b][M];w+=r[y][R].G*t[b][M];B+=r[y][R].B*t[b][M];A+=t[b][M];b++}M++}if(A==0){A=1}g=f(s/A);c=f(w/A);d=f(B/A);e[i][h]=new n(g,c,d)}}return e}function o(a,n){var o=a.data;var f=t(o,n);var i=r.gaussianBlur;var u=v(f,i);var h=e(u);for(var l=0,g=o.length;l<g;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function f(r,v){var o=r.data;var f=t(o,v);var i=a(f.length,f[0].length);function u(r,a){return r-a}for(var h=0;h<f.length;h++){for(var l=0;l<f[h].length;l++){var g=new Array(8);var c=f[h-1]||f[h];var d=f[h+1]||f[h];g[0]=c[l-1]||f[h][l];g[1]=f[h][l-1]||f[h][l];g[2]=d[l-1]||f[h][l];g[3]=c[l]||f[h][l];g[4]=f[h][l]||f[h][l];g[5]=d[l]||f[h][l];g[6]=c[l+1]||f[h][l];g[7]=f[h][l+1]||f[h][l];g[8]=d[l+1]||f[h][l];var s=[g[0].R,g[1].R,g[2].R,g[3].R,g[4].R,g[5].R,g[6].R,g[7].R].sort(u)[4];var w=[g[0].G,g[1].G,g[2].G,g[3].G,g[4].G,g[5].G,g[6].G,g[7].G].sort(u)[4];var B=[g[0].B,g[1].B,g[2].B,g[3].B,g[4].B,g[5].B,g[6].B,g[7].B].sort(u)[4];i[h][l]=new n(s,w,B)}}var A=e(i);for(var y=0,G=o.length;y<G;y+=4){o[y]=A[y];o[y+1]=A[y+1];o[y+2]=A[y+2];o[y+3]=A[y+3]}return}function i(a,n){var o=a.data;var f=t(o,n);var i=r.edge;var u=v(f,i);var h=e(u);for(var l=0,g=o.length;l<g;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function u(a,n){var o=a.data;var f=t(o,n);var i=r.sharpen;var u=v(f,i);var h=e(u);for(var l=0,g=o.length;l<g;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function h(r){var a=r.data;for(var n=0,t=a.length;n<t;n+=4){a[n+2]=a[n+1]=a[n]=a[n]*2+a[n+1]*5+a[n+2]*1>>3}return}function l(r){var a=r.data;var n=0;var t=new Array(256),e=new Array(256),v=new Array(256),o=new Array(256),f=new Array(256),i=new Array(256);for(var u=0;u<256;u++){t[u]=e[u]=v[u]=o[u]=f[u]=i[u]=0}for(var u=0,h=a.length;u<h;u+=4){t[a[u]]+=1;e[a[u+1]]+=1;v[a[u+2]]+=1;n+=1}for(var u=0;u<256;u++){var l=counterG=counterB=0;for(var g=0;g<=u;g++){l=l+t[g];counterG=counterG+e[g];counterB=counterB+v[g]}o[u]=Math.round(l/n*255);f[u]=Math.round(counterG/n*255);i[u]=Math.round(counterB/n*255)}for(var u=0,h=a.length;u<h;u+=4){a[u]=o[a[u]];a[u+1]=f[a[u+1]];a[u+2]=i[a[u+2]]}return}function g(r,a){var n=r.data;var t=new Array(n.length);for(var e=0,v=n.length;e<v;e+=4){var o=w(n[e],n[e+1],n[e+2]);t[e]=o[0];t[e+1]=o[1]+a;t[e+2]=o[2];t[e+3]=0}for(var e=0,v=t.length;e<v;e+=4){var f=B(t[e],t[e+1],t[e+2]);n[e]=f[0];n[e+1]=f[1];n[e+2]=f[2]}}function c(r,a){var n=r.data;var t=new Array(n.length);for(var e=0,v=n.length;e<v;e+=4){var o=w(n[e],n[e+1],n[e+2]);t[e]=o[0];t[e+1]=o[1];t[e+2]=o[2]+a;t[e+3]=0}for(var e=0,v=t.length;e<v;e+=4){var f=B(t[e],t[e+1],t[e+2]);n[e]=f[0];n[e+1]=f[1];n[e+2]=f[2]}}function d(r){var a=r.data;var n=new Array(a.length);var t=new Array(256);var e=new Array(256);var v=0;for(var o=0;o<256;o++){t[o]=0}for(var o=0,f=a.length;o<f;o+=4){var i=w(a[o],a[o+1],a[o+2]);n[o]=i[0];n[o+1]=i[1];n[o+2]=i[2];n[o+3]=0;t[i[2]]+=1;v+=1}for(var o=0;o<256;o++){var u=0;for(var h=0;h<=o;h++){u=u+t[h]}e[o]=Math.round(u/v*255)}for(var o=0,f=n.length;o<f;o+=4){n[o+2]=e[n[o+2]]}for(var o=0,f=a.length;o<f;o+=4){var l=B(n[o],n[o+1],n[o+2]);a[o]=l[0];a[o+1]=l[1];a[o+2]=l[2]}}function s(r){var a=r.data;for(var n=0,t=a.length;n<t;n+=4){a[n]=225-a[n];a[n+1]=225-a[n+1];a[n+2]=225-a[n+2]}return}function w(r,a,n){var t=Math.max(r,a,n);var e=Math.min(r,a,n);var v,o,f;if(t===e){return[0,0,t]}if(r===t){v=(a-n)/(t-e)}if(a===t){v=2+(n-r)/(t-e)}if(n===t){v=4+(r-a)/(t-e)}v=v*60;if(v<0){v=v+360}f=t;o=(t-e)/t;return[v,o,f]}function B(r,a,n){var t=n;var e,v,o;if(a===0){return[t,t,t]}else{var r=r/60;var f=Math.floor(r);var i=r-f;var u=n*(1-a);var h=n*(1-a*i);var l=n*(1-a*(1-i));switch(f){case 0:e=n;v=l;o=u;break;case 1:e=h;v=n;o=u;break;case 2:e=u;v=n;o=l;break;case 3:e=u;v=h;o=n;break;case 4:e=l;v=u;o=n;break;case 5:e=n;v=u;o=h;break}return[e,v,o]}}window.Simage={toMatrix:t,calculateByMatrix:v,decodeMatrix:e,gaussianBlur:o,edge:i,blackAndWhite:h,colorFlip:s,sharpen:u,medianFilter:f,modifiedSaturation:g,modifiedLight:c,histogramBlance:l,histogramBlanceWithColor:d}})();

(function(){var r={gaussianBlur:[[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,26,4],[1,4,6,4,1]],edge:[[2,-1,2],[-1,-4,-1],[2,-1,2]],detail:[[0,-1,0],[-1,10,-1],[0,-1,0]],sharpen:[[-1,-1,-1],[-1,10,-1],[-1,-1,-1]]};function a(r,a){var n=new Array(r);for(var e=0;e<r;e++){n[e]=new Array(a)}return n}function n(r,a,n,e){this.R=r;this.G=a;this.B=n;this.A=e}function e(r,e){var t=a(e,r.length/4/e);for(var v=0,o=r.length;v<o;v+=4){var f=Math.floor(v/(4*e));var i=v/4%e;t[i][f]=new n(r[v],r[v+1],r[v+2],r[v+3])}return t}function t(r){var a=r.length;var n=r[0].length;var e=new Uint8ClampedArray(a*n*4);var t=0;for(var v=0;v<n;v++){for(var o=0;o<a;o++){e[t]=r[o][v].R;e[t+1]=r[o][v].G;e[t+2]=r[o][v].B;if(r[o][v].A==undefined){e[t+3]=255}else{e[t+3]=r[o][v].A}t=t+4}}console.log(e);return e}function v(r,e){if(e.length%2==0){alert("核矩阵不正确！");return}var t=a(r.length,r[0].length);var v=(e.length-1)/2;var o=e.length;var f=Math.round;for(var i=0,u=r.length;i<u;i++){for(var l=0,h=r[i].length;l<h;l++){var c,g,s;var d=0;var w=0;var B=0;var A=0;for(var y=i-v,G=i+v,M=0;y<=G;y++){for(var R=l-v,b=l+v,k=0;R<=b;R++){if(y<0||R<0){continue}if(y>=r.length||R>=r[0].length){continue}try{d+=r[y][R].R*e[k][M]}catch(m){console.log(y,R);window.dataMatrix=r}w+=r[y][R].G*e[k][M];B+=r[y][R].B*e[k][M];A+=e[k][M];k++}M++}if(A==0){A=1}c=f(d/A);g=f(w/A);s=f(B/A);t[i][l]=new n(c,g,s)}}return t}function o(a,n){var o=a.data;var f=e(o,n);var i=r.gaussianBlur;var u=v(f,i);var l=t(u);for(var h=0,c=o.length;h<c;h+=4){o[h]=l[h];o[h+1]=l[h+1];o[h+2]=l[h+2];o[h+3]=l[h+3]}return}function f(r,v){var o=r.data;var f=e(o,v);var i=a(f.length,f[0].length);function u(r,a){return r-a}for(var l=0;l<f.length;l++){for(var h=0;h<f[l].length;h++){var c=new Array(8);var g=f[l-1]||f[l];var s=f[l+1]||f[l];c[0]=g[h-1]||f[l][h];c[1]=f[l][h-1]||f[l][h];c[2]=s[h-1]||f[l][h];c[3]=g[h]||f[l][h];c[4]=f[l][h]||f[l][h];c[5]=s[h]||f[l][h];c[6]=g[h+1]||f[l][h];c[7]=f[l][h+1]||f[l][h];c[8]=s[h+1]||f[l][h];var d=[c[0].R,c[1].R,c[2].R,c[3].R,c[4].R,c[5].R,c[6].R,c[7].R].sort(u)[4];var w=[c[0].G,c[1].G,c[2].G,c[3].G,c[4].G,c[5].G,c[6].G,c[7].G].sort(u)[4];var B=[c[0].B,c[1].B,c[2].B,c[3].B,c[4].B,c[5].B,c[6].B,c[7].B].sort(u)[4];i[l][h]=new n(d,w,B)}}var A=t(i);for(var y=0,G=o.length;y<G;y+=4){o[y]=A[y];o[y+1]=A[y+1];o[y+2]=A[y+2];o[y+3]=A[y+3]}return}function i(a,n){var o=a.data;var f=e(o,n);var i=r.edge;var u=v(f,i);var l=t(u);for(var h=0,c=o.length;h<c;h+=4){o[h]=l[h];o[h+1]=l[h+1];o[h+2]=l[h+2];o[h+3]=l[h+3]}return}function u(a,n){var o=a.data;var f=e(o,n);var i=r.sharpen;var u=v(f,i);var l=t(u);for(var h=0,c=o.length;h<c;h+=4){o[h]=l[h];o[h+1]=l[h+1];o[h+2]=l[h+2];o[h+3]=l[h+3]}return}function l(r){var a=r.data;for(var n=0,e=a.length;n<e;n+=4){a[n+2]=a[n+1]=a[n]=a[n]*2+a[n+1]*5+a[n+2]*1>>3}return}function h(r){var a=r.data;var n=0;var e=new Array(256),t=new Array(256),v=new Array(256),o=new Array(256),f=new Array(256),i=new Array(256);for(var u=0;u<256;u++){e[u]=t[u]=v[u]=o[u]=f[u]=i[u]=0}for(var u=0,l=a.length;u<l;u+=4){e[a[u]]+=1;t[a[u+1]]+=1;v[a[u+2]]+=1;n+=1}for(var u=0;u<256;u++){var h=counterG=counterB=0;for(var c=0;c<=u;c++){h=h+e[c];counterG=counterG+t[c];counterB=counterB+v[c]}o[u]=Math.round(h/n*255);f[u]=Math.round(counterG/n*255);i[u]=Math.round(counterB/n*255)}for(var u=0,l=a.length;u<l;u+=4){a[u]=o[a[u]];a[u+1]=f[a[u+1]];a[u+2]=i[a[u+2]]}return}function c(r){var a=r.data;var n=new Array(a.length);var e=new Array(256);var t=new Array(256);var v=0;for(var o=0;o<256;o++){e[o]=0}for(var o=0,f=a.length;o<f;o+=4){var i=s(a[o],a[o+1],a[o+2]);n[o]=i[0];n[o+1]=i[1];n[o+2]=i[2];n[o+3]=0;e[i[2]]+=1;v+=1}for(var o=0;o<256;o++){var u=0;for(var l=0;l<=o;l++){u=u+e[l]}t[o]=Math.round(u/v*255)}console.log(t);for(var o=0,f=n.length;o<f;o+=4){n[o+2]=t[n[o+2]]}for(var o=0,f=a.length;o<f;o+=4){var h=d(n[o],n[o+1],n[o+2]);a[o]=h[0];a[o+1]=h[1];a[o+2]=h[2];if(h[0]==0&&h[1]==0&&h[2]==0){}}}function g(r){var a=r.data;for(var n=0,e=a.length;n<e;n+=4){a[n]=225-a[n];a[n+1]=225-a[n+1];a[n+2]=225-a[n+2]}return}function s(r,a,n){var e=Math.max(r,a,n);var t=Math.min(r,a,n);var v,o,f;if(e===t){return[0,0,e]}if(r===e){v=(a-n)/(e-t)}if(a===e){v=2+(n-r)/(e-t)}if(n===e){v=4+(r-a)/(e-t)}v=v*60;if(v<0){v=v+360}f=e;o=(e-t)/e;if(v==0&&o==0&&f==0){console(r,a,n)}return[v,o,f]}function d(r,a,n){var e=n;var t,v,o;if(a===0){return[e,e,e]}else{var r=r/60;var f=Math.floor(r);var i=r-f;var u=n*(1-a);var l=n*(1-a*i);var h=n*(1-a*(1-i));switch(f){case 0:t=n;v=h;o=u;break;case 1:t=l;v=n;o=u;break;case 2:t=u;v=n;o=h;break;case 3:t=u;v=l;o=n;break;case 4:t=h;v=u;o=n;break;case 5:t=n;v=u;o=l;break}return[t,v,o]}}window.Simage={toMatrix:e,calculateByMatrix:v,decodeMatrix:t,gaussianBlur:o,edge:i,blackAndWhite:l,colorFlip:g,sharpen:u,medianFilter:f,histogramBlance:h,histogramBlanceWithColor:c}})();

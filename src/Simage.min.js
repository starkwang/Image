(function(){var r={gaussianBlur:[[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,26,4],[1,4,6,4,1]],edge:[[2,-1,2],[-1,-4,-1],[2,-1,2]],detail:[[0,-1,0],[-1,10,-1],[0,-1,0]],sharpen:[[-1,-1,-1],[-1,10,-1],[-1,-1,-1]]};function a(r,a){var n=new Array(r);for(var e=0;e<r;e++){n[e]=new Array(a)}return n}function n(r,a,n,e){this.R=r;this.G=a;this.B=n;this.A=e}function e(r,e){var t=a(e,r.length/4/e);for(var v=0,o=r.length;v<o;v+=4){var f=Math.floor(v/(4*e));var u=v/4%e;t[u][f]=new n(r[v],r[v+1],r[v+2],r[v+3])}return t}function t(r){var a=r.length;var n=r[0].length;var e=new Uint8ClampedArray(a*n*4);var t=0;for(var v=0;v<n;v++){for(var o=0;o<a;o++){e[t]=r[o][v].R;e[t+1]=r[o][v].G;e[t+2]=r[o][v].B;if(r[o][v].A==undefined){e[t+3]=255}else{e[t+3]=r[o][v].A}t=t+4}}return e}function v(r,e){if(e.length%2==0){alert("核矩阵不正确！");return}var t=a(r.length,r[0].length);var v=(e.length-1)/2;var o=e.length;var f=Math.round;for(var u=0,i=r.length;u<i;u++){for(var h=0,l=r[u].length;h<l;h++){var c,g,s;var d=0;var B=0;var w=0;var A=0;for(var G=u-v,y=u+v,M=0;G<=y;G++){for(var R=h-v,b=h+v,k=0;R<=b;R++){if(G<0||R<0){continue}if(G>=r.length||R>=r[0].length){continue}d+=r[G][R].R*e[k][M];B+=r[G][R].G*e[k][M];w+=r[G][R].B*e[k][M];A+=e[k][M];k++}M++}if(A==0){A=1}c=f(d/A);g=f(B/A);s=f(w/A);t[u][h]=new n(c,g,s)}}return t}function o(a,n){var o=a.data;var f=e(o,n);var u=r.gaussianBlur;var i=v(f,u);var h=t(i);for(var l=0,c=o.length;l<c;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function f(r,v){var o=r.data;var f=e(o,v);var u=a(f.length,f[0].length);function i(r,a){return r-a}for(var h=0;h<f.length;h++){for(var l=0;l<f[h].length;l++){var c=new Array(8);var g=f[h-1]||f[h];var s=f[h+1]||f[h];c[0]=g[l-1]||f[h][l];c[1]=f[h][l-1]||f[h][l];c[2]=s[l-1]||f[h][l];c[3]=g[l]||f[h][l];c[4]=f[h][l]||f[h][l];c[5]=s[l]||f[h][l];c[6]=g[l+1]||f[h][l];c[7]=f[h][l+1]||f[h][l];c[8]=s[l+1]||f[h][l];var d=[c[0].R,c[1].R,c[2].R,c[3].R,c[4].R,c[5].R,c[6].R,c[7].R].sort(i)[4];var B=[c[0].G,c[1].G,c[2].G,c[3].G,c[4].G,c[5].G,c[6].G,c[7].G].sort(i)[4];var w=[c[0].B,c[1].B,c[2].B,c[3].B,c[4].B,c[5].B,c[6].B,c[7].B].sort(i)[4];u[h][l]=new n(d,B,w)}}var A=t(u);for(var G=0,y=o.length;G<y;G+=4){o[G]=A[G];o[G+1]=A[G+1];o[G+2]=A[G+2];o[G+3]=A[G+3]}return}function u(a,n){var o=a.data;var f=e(o,n);var u=r.edge;var i=v(f,u);var h=t(i);for(var l=0,c=o.length;l<c;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function i(a,n){var o=a.data;var f=e(o,n);var u=r.sharpen;var i=v(f,u);var h=t(i);for(var l=0,c=o.length;l<c;l+=4){o[l]=h[l];o[l+1]=h[l+1];o[l+2]=h[l+2];o[l+3]=h[l+3]}return}function h(r){var a=r.data;for(var n=0,e=a.length;n<e;n+=4){a[n+2]=a[n+1]=a[n]=a[n]*2+a[n+1]*5+a[n+2]*1>>3}return}function l(r){var a=r.data;var n=0;var e=new Array(256),t=new Array(256),v=new Array(256),o=new Array(256),f=new Array(256),u=new Array(256);for(var i=0;i<256;i++){e[i]=t[i]=v[i]=o[i]=f[i]=u[i]=0}for(var i=0,h=a.length;i<h;i+=4){e[a[i]]+=1;t[a[i+1]]+=1;v[a[i+2]]+=1;n+=1}for(var i=0;i<256;i++){var l=counterG=counterB=0;for(var c=0;c<=i;c++){l=l+e[c];counterG=counterG+t[c];counterB=counterB+v[c]}o[i]=Math.round(l/n*255);f[i]=Math.round(counterG/n*255);u[i]=Math.round(counterB/n*255)}for(var i=0,h=a.length;i<h;i+=4){a[i]=o[a[i]];a[i+1]=f[a[i+1]];a[i+2]=u[a[i+2]]}return}function c(r){var a=r.data;var n=new Array(a.length);var e=new Array(256);var t=new Array(256);var v=0;for(var o=0;o<256;o++){e[o]=0}for(var o=0,f=a.length;o<f;o+=4){var u=s(a[o],a[o+1],a[o+2]);n[o]=u[0];n[o+1]=u[1];n[o+2]=u[2];n[o+3]=0;e[u[2]]+=1;v+=1}for(var o=0;o<256;o++){var i=0;for(var h=0;h<=o;h++){i=i+e[h]}t[o]=Math.round(i/v*255)}for(var o=0,f=n.length;o<f;o+=4){n[o+2]=t[n[o+2]]}for(var o=0,f=a.length;o<f;o+=4){var l=d(n[o],n[o+1],n[o+2]);a[o]=l[0];a[o+1]=l[1];a[o+2]=l[2]}}function g(r){var a=r.data;for(var n=0,e=a.length;n<e;n+=4){a[n]=225-a[n];a[n+1]=225-a[n+1];a[n+2]=225-a[n+2]}return}function s(r,a,n){var e=Math.max(r,a,n);var t=Math.min(r,a,n);var v,o,f;if(e===t){return[0,0,e]}if(r===e){v=(a-n)/(e-t)}if(a===e){v=2+(n-r)/(e-t)}if(n===e){v=4+(r-a)/(e-t)}v=v*60;if(v<0){v=v+360}f=e;o=(e-t)/e;return[v,o,f]}function d(r,a,n){var e=n;var t,v,o;if(a===0){return[e,e,e]}else{var r=r/60;var f=Math.floor(r);var u=r-f;var i=n*(1-a);var h=n*(1-a*u);var l=n*(1-a*(1-u));switch(f){case 0:t=n;v=l;o=i;break;case 1:t=h;v=n;o=i;break;case 2:t=i;v=n;o=l;break;case 3:t=i;v=h;o=n;break;case 4:t=l;v=i;o=n;break;case 5:t=n;v=i;o=h;break}return[t,v,o]}}window.Simage={toMatrix:e,calculateByMatrix:v,decodeMatrix:t,gaussianBlur:o,edge:u,blackAndWhite:h,colorFlip:g,sharpen:i,medianFilter:f,histogramBlance:l,histogramBlanceWithColor:c}})();
